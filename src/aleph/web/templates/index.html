<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aleph Node</title>
    <style>

        @font-face {
            font-family: 'IBM Plex Mono';
            font-weight: normal;
            src: url(/static/IBM_Plex_Mono/IBMPlexMono-Light.ttf);
        }
        @font-face {
            font-family: 'IBM Plex Mono';
            font-weight: bold;
            src: url(/static/IBM_Plex_Mono/IBMPlexMono-Bold.ttf);
        }

        body {
            font-family: IBM Plex Regular,monospace;
            margin: 5vw;
        }
    </style>
</head>
<body>
<h1>Aleph Node</h1>

<section>
    <p>
        This is an <a href="https://aleph.im/">Aleph.im</a> node.
    </p>
    <p>
        See <a href="https://github.com/aleph-im/pyaleph">Repository</a>
    </p>

</section>

<hr/>

<section>
    <h2>Sync status</h2>

    <p>
        Messages stored: <span id="messages">{{ messages }}</span>
    </p>
    <p>
        Pending messages: <span id="pending_messages">{{ pending_messages }}</span>
    </p>
</section>

<script>
    const statusUrl = `ws://${window.location.host}/api/ws0/status`;

    function connectStatusWs() {
        const statusSocket = new WebSocket(statusUrl);

        statusSocket.onopen = function (event) {
            console.log("Socket open");
        };

        statusSocket.onmessage = function (event) {
            const data = JSON.parse(event.data)
            document.getElementById('messages').innerText = data['messages'];
            document.getElementById('pending_messages').innerText = data['pending_messages'];
        }

        statusSocket.onclose = function(e) {
            console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
            setTimeout(function() {
                connectStatusWs();
            }, 1000);
        };

        statusSocket.onerror = function(err) {
            console.error('Socket encountered error: ', err.message, 'Closing socket');
            statusSocket.close();
        };
    }

    connectStatusWs();

</script>

</body>
</html>